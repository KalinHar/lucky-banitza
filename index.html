<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="assets/26.png">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <title>БАНИЦА</title>
</head>

<body>
    <div id="app">
        <div class="banitza">
            <img v-if="lucks.length" class="banitza-img" :src="`./assets/${lucks.length}.png`" @click="choosePiece">
        </div>
    </div>
</body>

</html>

<script>
    const { createApp } = Vue;

    const getAllUrl = 'https://parseapi.back4app.com/classes/vizitec';
    const setLuckUrl = (id) => `${getAllUrl}/${id}`;
    const headers = {
        'X-Parse-Application-Id': 'bRrAggyHMoMVL9uPNl4T9XPzDFxHMRIrxTEieDEN',
        'X-Parse-REST-API-Key': 'oyNNM1odjhrSzfCkWtVmkFTiZPgmZUelFFkE5uhX'
    }

    const allLucks = ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12', '13', '14', '15', '16', '17', '18', '19', '20', '21', '22', '23', '24', '25', '26'];
    const wishes = {
        '1': 'Повишение със сигурност ще имаш ти, защото шефа страшно те цени.',
        '2': 'Стягай се за почерпка отсега – през новата година ще подкараш нова кола.',
        '3': 'На вратата, като че ли нещо тебе чака и това не са сметките за тока и водата...Май са топка пелени и бебенце ще чакаш ти.',
        '4': 'Очакват те безброй нови имоти, купени с неочаквани наследствени банкноти.',
        '5': 'Любов ще грее силно твоето сърце, като чисто ново циганско кюмбе.',
        '6': 'Хм, я вземи чадъра и наопаки го обърни, че за теб от утре започва порой от пари.',
        '7': 'Знаем, хич не ти спори учението. Затова на теб се пада приключението.',
        '8': 'Безкрайно веселие и купон подир купон, от тебе се очаква само да даваш тон!',
        '9': 'На тебе мързелът се пада – да мързелуваш ти приляга!',
        '10': 'Плюй си на петите и беж, че очаква те годеж!',
        '11': 'Най-голямата награда – здравето – на теб се пада!',
        '12': 'Годината ще е добра, ще я отбележиш с пътуване до тайнствена страна!',
        '13': 'Ще бъдеш със сила и смелост окрилен, повече даже и от Спайдърмен!',
        '14': 'Стилна къща с камина пада ти се таз година! С двор, с гараж и с куче – нов, мечтан дом ще получиш!',
        '15': 'Ех, най-добрия късмет случи – пада ти се здраве и благополучие! ',
        '16': 'Хич да не ти пука – догодина наслука!',
        '17': 'Късметът на теб се пада, ще си облечен в дрехи на Прада!',
        '18': 'Кариерата ще ти е приоритет, ще се изкачваш смело напред!',
        '19': 'Няма да се отървеш от фенки, ще им трябват наколенки.',
        '20': 'Раничката си стегни, ще караш ски във чужди планини!',
        '21': 'Щастието ще е с теб, ще отидеш на гурбет.',
        '22': 'От мързел няма да се отървеш, за тебе друг ще бачка щеш не щеш!',
        '23': 'На колегите от сърце се усмихни, догодина от Хавай ще им пращаш поздрави!',
        '24': 'Батериите здраво зареди – за тиймбилдинг на круиз се приготви!',
        '25': 'Дори да има в обществото кризи, ще ги изкараш на петзвездни круизи!',
        '26': 'Няма бариера пред твоята кариера. Работата ще е песен, а живота ти чудесен!'
    }

    createApp({
        data() {
            return {
                lucks: [],
                luck: '',
                emails: [],
                email: {},
            }
        },
        async mounted() {
            await this.setLocalState();
        },
        methods: {
            async choosePiece() {
                email = prompt('Въведи e-mail');
                await this.setLocalState();
                const emailIndex = this.emails.findIndex(obj => obj.email === email);

                console.log(this.emails);

                if (emailIndex > -1) {
                    this.email = this.emails[emailIndex]
                    this.emails[emailIndex].luck.length
                        ? alert('Вече си изтеглил късмет от баницата!')
                        : this.pickLuck();
                } else {
                    alert('Въведен е невалиден e-mail');
                }
            },
            async pickLuck() {
                await this.setLocalState();
                this.luck = this.lucks[Math.round(Math.random() * (this.lucks.length - 1))];
                console.log(this.luck);
                await this.setLuckRemote();
                await setLocalState();
            },
            async setLocalState() {
                this.emails = await this.getAllEmails();
                const usedLucks = this.emails.map(email => email.luck);
                this.lucks = allLucks.filter(luck => !usedLucks.includes(luck));
            },
            async getAllEmails() {
                const emailsResponse = await fetch(getAllUrl, { headers });
                const emailsResult = await emailsResponse.json();
                return emailsResult.results;
            },
            async setLuckRemote() {
                const luckResponse = await fetch(setLuckUrl(this.email.objectId), {
                    method: 'PUT',
                    headers,
                    body: JSON.stringify({ luck: this.luck })
                });
            }
        }
    }).mount('#app')
</script>

<style>
    body {
        background: url("assets/bkg.png");
        background-size: cover;
    }

    #app {
        height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .banitza {
        display: flex;
        flex-direction: row;
        justify-content: space-between;
    }

    .banitza-img {
        height: 80vh;
        animation: spin 2.5s ease-out 1;
    }

    @keyframes spin {
        from {
            transform: rotate(0deg);
        }

        to {
            transform: rotate(1080deg);
        }
    }

    .piece {
        cursor: pointer;
        background-color: yellow;
        padding: 5px
    }
</style>
